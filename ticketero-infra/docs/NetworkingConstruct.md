# NetworkingConstruct - VPC and Security Groups

## Overview

The NetworkingConstruct creates the foundational networking infrastructure for the Ticketero application, including VPC, subnets, and security groups following the principle of least privilege.

## Architecture

```
VPC 10.0.0.0/16
├── Public Subnets (2 AZs)
│   ├── 10.0.1.0/24 (AZ-a)
│   └── 10.0.2.0/24 (AZ-b)
├── Private Subnets (2 AZs)
│   ├── 10.0.11.0/24 (AZ-a)
│   └── 10.0.12.0/24 (AZ-b)
├── Internet Gateway
└── NAT Gateways (1 for dev, 2 for prod)
```

## Security Groups

### 1. ALB Security Group (`ticketero-{env}-alb-sg`)
- **Purpose**: Application Load Balancer
- **Inbound**: HTTP (80), HTTPS (443) from anywhere (0.0.0.0/0)
- **Outbound**: All traffic allowed

### 2. ECS Security Group (`ticketero-{env}-ecs-sg`)
- **Purpose**: ECS Fargate tasks
- **Inbound**: Port 8080 from ALB Security Group only
- **Outbound**: All traffic allowed (for external API calls)

### 3. RDS Security Group (`ticketero-{env}-rds-sg`)
- **Purpose**: PostgreSQL database
- **Inbound**: Port 5432 from ECS Security Group only
- **Outbound**: No outbound traffic allowed

### 4. Amazon MQ Security Group (`ticketero-{env}-mq-sg`)
- **Purpose**: RabbitMQ message broker
- **Inbound**: 
  - Port 5671 (AMQPS) from ECS Security Group
  - Port 443 (HTTPS Console) from ECS Security Group
- **Outbound**: No outbound traffic allowed

## Environment Differences

| Resource | Development | Production |
|----------|-------------|------------|
| NAT Gateways | 1 | 2 (High Availability) |
| Cost Impact | ~$45/month | ~$90/month |

## Security Principles

1. **Least Privilege**: Each security group only allows necessary traffic
2. **Defense in Depth**: Multiple layers of security (ALB → ECS → Database)
3. **Network Segmentation**: Private subnets for backend services
4. **Reference-based Rules**: Security groups reference each other instead of IP ranges

## Generated Resources

- 1 VPC
- 4 Subnets (2 public, 2 private)
- 1 Internet Gateway
- 1-2 NAT Gateways (environment dependent)
- 4 Security Groups
- Route tables and associations (auto-generated by CDK)

## Usage

```java
NetworkingConstruct networking = new NetworkingConstruct(this, "Networking", config);

// Access VPC for other constructs
Vpc vpc = networking.getVpc();

// Access security groups
SecurityGroup albSg = networking.getAlbSg();
SecurityGroup ecsSg = networking.getEcsSg();
SecurityGroup rdsSg = networking.getRdsSg();
SecurityGroup mqSg = networking.getMqSg();
```

## Testing

The NetworkingConstruct is validated through:
1. **Unit Tests**: Configuration validation (no Node.js required)
2. **CDK Integration Tests**: CloudFormation template validation (requires Node.js)

Run tests:
```bash
# Configuration tests
mvn test -Dtest=TicketeroStackTest

# CDK integration tests (requires Node.js)
mvn test -Dtest=TicketeroStackCdkTest
```